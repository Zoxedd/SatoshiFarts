<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Satoshi's Fart</title>
    <!-- Tailwind & custom CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body class="flex flex-col items-center justify-center p-4 bg-black text-[#39ff14]">
    <!-- Intro overlay -->
    <div id="introOverlay" class="intro-container">
      <div class="intro-text">The Original Gas Fee.</div>
    </div>

    <audio id="fart-sound" src="/fart.mp3" preload="auto"></audio>

    <header class="w-full mb-8 text-center">
      <h1 class="mb-2">SATOSHI'S FART</h1>
      <p>Decentralized flatulence. Gas has never been so expensive.</p>
    </header>

    <!-- Scrolling lore -->
    <div class="crawl-container w-full max-w-screen-lg mx-auto">
      <div class="crawl paused" id="crawlText">
        <p>In the dawn of Bitcoin, a singular cosmic expulsion known only as Satoshi's Fart rippled through the nascent network. That first gas feeâ€”tiny, unassuming, yet eternalâ€”sparked the blocks, setting the blockchain ablaze in a cascade of cryptographic proof.</p>
        <p>From that primordial gust rose the sprawling empire of memecoins, DeFi schemes, and digital gold. Each transaction, every smart contract, owes its ignition to the original fee tokenized here: the essence of Satoshi's Fart itself.</p>
        <p>Today, we bottle that legendary gas, honoring the flatulent genesis of decentralized finance. Mint your own fragment of blockchain history, and let Satoshiâ€™s Fart propel you into the next era of on-chain adventures.</p>
      </div>
    </div>

    <main class="flex flex-col items-center w-full px-4">
      <div class="w-full mb-8">
        <img
          src="/SatoshiFarts.png"
          alt="Satoshi's Fart"
          class="mx-auto max-w-full h-auto rounded-xl shadow-lg"
        />
      </div>

      <button
        id="mint-btn"
        class="bg-green-500 hover:bg-green-400 text-black font-bold rounded-full transition duration-200 mb-8"
      >
        MINT A FART ðŸ’¨
      </button>

      <!-- Verify Holder button -->
      <button
        id="verify-btn"
        class="bg-green-700 hover:bg-green-600 text-black font-bold rounded-full transition duration-200 px-6 py-3 mb-12"
      >
        Verify Holder Access ðŸ”‘
      </button>

      <section id="swap-widget" class="w-full max-w-screen-lg mx-auto mb-12">
        <h2 class="text-center mb-4">Swap SOL for Satoshi's Fart</h2>
        <iframe
          class="jup-swap w-full"
          src="https://jup.ag/swap/SOL-FyWVxZidhhoWPTNjPLr1K5KeU7APFZdKutxP87Enpump"
          frameborder="0"
          allowfullscreen
        ></iframe>
      </section>

      <!-- Donate Section -->
      <section id="donate" class="w-full max-w-screen-lg mx-auto mb-12 p-6 bg-black bg-opacity-50 rounded-xl text-center">
        <h2 class="text-2xl mb-4">ðŸš€ Support Our Marketing</h2>
        <p class="mb-4">Send SOL here to fuel our next push:</p>
        <div class="flex items-center justify-center space-x-2 mb-4">
          <code
            id="donationAddr"
            class="font-mono bg-gray-900 px-4 py-2 rounded text-green-300"
          >
            9G7UoQ4vZSmXGiTwJ25oMf6yxrk2HRfJCqXAp8YJSMzq
          </code>
          <button
            id="copyAddrBtn"
            class="bg-green-500 hover:bg-green-400 text-black font-bold py-2 px-4 rounded"
          >
            Copy
          </button>
        </div>
        <a
          href="https://solscan.io/account/9G7UoQ4vZSmXGiTwJ25oMf6yxrk2HRfJCqXAp8YJSMzq?exclude_amount_zero=true&remove_spam=true#transfers"
          target="_blank"
          rel="noopener noreferrer"
          class="underline text-green-400"
        >
          View on Solscan
        </a>
      </section>
    </main>

    <footer class="w-full mt-0 text-center text-sm opacity-70">
      <p>&copy; 2025 Satoshi's Fart DAO. All gas rights reserved.</p>
      <div class="mt-4 space-x-6">
        <!-- always-visible links -->
        <a
          href="https://x.com/NoveskeBoiiii"
          target="_blank"
          rel="noopener noreferrer"
        >
          X (Twitter)
        </a>
        <a
          href="https://t.me/SFartSatoshisFart"
          target="_blank"
          rel="noopener noreferrer"
        >
          Telegram
        </a>
        <!-- hidden until holder verification -->
        <div id="tg-holders-only" style="display: none;">
          <a
            id="tg-invite-link"
            href="#"
            target="_blank"
            rel="noopener noreferrer"
          >
            Telegram (Holders Only)
          </a>
        </div>
      </div>
    </footer>

    <!-- existing UI scripts -->
    <script>
      const intro = document.getElementById('introOverlay');
      const crawl = document.getElementById('crawlText');
      intro.addEventListener('animationend', () => {
        intro.style.display = 'none';
        crawl.classList.remove('paused');
        crawl.classList.add('running');
      });

      document.getElementById('mint-btn').addEventListener('click', e => {
        e.preventDefault();
        const sound = document.getElementById('fart-sound');
        const dexUrl =
          'https://dexscreener.com/solana/gtqypcgfkxnuods3r7zhazquvauks4djeounk5yzquzt';
        window.open(dexUrl, '_blank');
        sound.currentTime = 0;
        sound.play().catch(err => console.warn('Sound blocked', err));
      });

      crawl.addEventListener('click', () => crawl.classList.toggle('running'));

      document.getElementById('copyAddrBtn').addEventListener('click', () => {
        navigator.clipboard
          .writeText(document.getElementById('donationAddr').innerText)
          .then(() => alert('Address copied!'));
      });
    </script>

    <!-- wallet and verification logic with error handling -->
    <script src="https://unpkg.com/@solana/web3.js@latest/lib/index.iife.min.js"></script>
    <script src="https://unpkg.com/@solana/spl-token@latest/lib/index.iife.min.js"></script>
    <script>
      (async () => {
        const TOKEN_MINT = new solanaWeb3.PublicKey(
          'FyWVxZidhhoWPTNjPLr1K5KeU7APFZdKutxP87Enpump'
        );
        const connection = new solanaWeb3.Connection(
          solanaWeb3.clusterApiUrl('mainnet-beta'),
          'confirmed'
        );
        const verifyBtn = document.getElementById('verify-btn');
        const tgDiv = document.getElementById('tg-holders-only');
        const tgLink = document.getElementById('tg-invite-link');
        let provider;

        function safeDisconnect() {
          if (provider && provider.isConnected) {
            provider.disconnect().catch(() => {});
          }
        }
        window.addEventListener('pagehide', safeDisconnect);
        window.addEventListener('beforeunload', safeDisconnect);

        verifyBtn.addEventListener('click', async (e) => {
          e.preventDefault();
          try {
            console.log('Starting holder verification...');

            // Detect wallet provider
            if (window.solana && window.solana.isPhantom) {
              provider = window.solana;
            } else if (window.solflare && window.solflare.isSolflare) {
              provider = window.solflare;
            } else {
              alert('No Solana wallet found. Please install Phantom or Solflare.');
              return;
            }

            // Connect wallet and grab publicKey
            const response = await provider.connect();
            const userKey = response.publicKey;

            if (!userKey) {
              alert('Failed to connect wallet. Please try again.');
              return;
            }

            alert('Wallet connected: ' + userKey.toBase58());

            // Fetch token accounts
            const parsed = await connection.getParsedTokenAccountsByOwner(userKey, {
              programId: solanaWeb3.TOKEN_PROGRAM_ID,
            });

            // Check token balance
            const hasToken = parsed.value.some(
              (acc) =>
                acc.account.data.parsed.info.mint === TOKEN_MINT.toString() &&
                acc.account.data.parsed.info.tokenAmount.uiAmount > 0
            );

            if (!hasToken) {
              alert('ðŸš« You need at least 1 token to access the private Telegram group.');
              return;
            }

            alert('âœ… Token verified! Revealing private Telegram link.');

            // Reveal Telegram link
            verifyBtn.style.display = 'none';
            tgLink.href = 'https://t.me/+OK3C9ZPdY3RiYjcx'; // Private holders TG link
            tgDiv.style.display = 'inline-block';
          } catch (err) {
            console.error('Verification error:', err);
            alert('Error during verification: ' + err.message);
          }
        });
      })();
    </script>
  </body>
</html>
